<ion-view left-buttons="leftButtons">
  <ion-nav-title>
    <span class="hidden-xs" translate>REGISTRY.SEARCH.TITLE</span>
    <span class="visible-xs" translate>REGISTRY.SEARCH.TITLE_SMALL_DEVICE</span>
  </ion-nav-title>

  <ion-content class="lookupForm padding no-padding-xs">

    <div class="item no-border " style="display: block; height: 60px;">

      <div class="pull-right">
        <button class="button button-small button-positive button-clear ink hidden-sm hidden-xs"
                ng-click="showNewPageModal()">
          <i class="icon ion-plus"></i>
          {{'REGISTRY.BTN_NEW' | translate}}
        </button>
        <div
          class="button dark"
          title="{{'REGISTRY.BTN_SHOW_WOT_HELP' | translate}}"
          ui-sref="app.wot_lookup">
          <i class="icon ion-person-stalker"></i>
          {{'REGISTRY.BTN_SHOW_WOT' | translate}}
        </div>
        <div
          class="button ink yellow-bg dark"
          title="{{'REGISTRY.BTN_SHOW_PAGES_HELP' | translate}}"
          >
          <i class="icon ion-social-buffer"></i>
          {{'REGISTRY.BTN_SHOW_PAGES' | translate}}
        </div>
      </div>
    </div>

    <form ng-submit="doSearch()"/>
      <label class="item item-input">
          <i class="icon ion-search placeholder-icon"></i>
          <input type="text"
                 class="visible-xs visible-sm"
                 placeholder="{{'REGISTRY.SEARCH.SEARCH_HELP'|translate}}"
                 ng-model="search.text"
                 ng-model-options="{ debounce: 350 }"
                 ng-change="doSearch()">
          <input type="text"
                 class="hidden-xs hidden-sm"
                 placeholder="{{'REGISTRY.SEARCH.SEARCH_HELP'|translate}}"
                 id="registrySearchText"
                 ng-model="search.text"
                 on-return="doSearch()">
      </label>

      <!-- location -->
      <div class="item no-padding" >
        <div class="item-input ">

          <i class="icon ion-location placeholder-icon"></i>
          <input type="text"
                 class="visible-xs visible-sm"
                 placeholder="{{(options.location.help||'REGISTRY.SEARCH.LOCATION_HELP')|translate}}"
                 ng-model="search.location"
                 ng-model-options="{ debounce: 350 }"
                 ng-change="doSearch()">
          <input type="text"
                 class="hidden-xs hidden-sm"
                 placeholder="{{(options.location.help||'REGISTRY.SEARCH.LOCATION_HELP')|translate}}"
                 ng-model="search.location"
                 on-return="doSearch()">
        </div>
      </div>

      <!-- options -->
      <ng-include src="'plugins/es/templates/registry/lookup_options.html'"></ng-include>
    </form>

    <div class="padding-top padding-xs" style="display: block; height: 60px;">

      <div class="hidden-xs hidden-sm pull-left" >

        <a class="button button-text button-small ink "
           ng-class="{'button-text-stable': !search.advanced, 'button-text-positive': search.advanced}"
           ng-click="search.advanced=!search.advanced">
          <i class="icon ion-ios-gear"></i>
          {{'REGISTRY.SEARCH.BTN_OPTIONS' | translate}}
          <i class="icon" ng-class="{'ion-arrow-down-b': !search.advanced, 'ion-arrow-up-b': search.advanced}"></i>
        </a>

        &nbsp;

      </div>

      <div class="hidden-xs hidden-sm pull-right">

        <a class="button button-text button-small ink hidden-sm hidden-xs"
           title="{{'MAP.REGISTRY.LOOKUP.BTN_MAP_HELP' | translate}}"
           ui-sref="app.view_registry_map">
          <i class="icon ion-ios-location"></i>
          {{'MAP.REGISTRY.LOOKUP.BTN_MAP' | translate}}
        </a>

        <!-- Allow extension here -->
        <cs-extension-point name="filter-buttons"></cs-extension-point>

        &nbsp;

        <button class="button button-small button-stable ink"
                ng-click="doSearch()">
          {{'COMMON.BTN_SEARCH' | translate}}
        </button>
      </div>
    </div>

    <div class="padding-xs" style="display: block; height: 60px;">
      <div class="pull-left">
        <h4
          ng-if="!search.loading && search.lastRecords && search.results.length" translate>
          REGISTRY.SEARCH.LAST_RECORDS
        </h4>
        <h4
          ng-if="!search.loading && !search.lastRecords && (search.text.length || search.advanced != null)" translate>
          COMMON.RESULTS_LIST
        </h4>
      </div>
    </div>

    <div class="center" ng-if="search.loading">
      <ion-spinner icon="android"></ion-spinner>
    </div>

    <div class="padding assertive" ng-if="!search.loading && search.results.length===0 && search.advanced != null" translate>
      COMMON.SEARCH_NO_RESULT
    </div>

    <div class="list {{::motion.ionListClass}}"
         ng-if="!search.loading && search.results && search.results.length > 0">

      <a ng-repeat="item in search.results"
         class="item ink padding-xs"
         ui-sref="app.view_page({id: item.id, title: item.urlTitle})">

        <ng-include src="'plugins/es/templates/registry/lookup_item.html'"></ng-include>
      </a>
    </div>

    <ion-infinite-scroll
      ng-if="!search.loading && search.hasMore"
      spinner="android"
      on-infinite="showMore()"
      distance="10%">
    </ion-infinite-scroll>
  </ion-content>



  <button id="fab-add-registry-record"
          class="button button-fab button-fab-bottom-right button-assertive icon ion-plus hidden-md hidden-lg spin"
          ng-click="showNewPageModal()">
  </button>
</ion-view>
